# Il servizio di comunicazione
Dati due entità remote, quando parliamo di servizio di comunicazione intendiamo
il fornitore del servizio di trasporto dell'informazione.

Il colloquio tra due entità non corrisponde con il servizio di comunicazione:
il colloquio è il contenuto, il servizio di comunicazione è ciò che sposta il
contenuto.

IL servizio di comunicazione gestisce lo scambio di informazione fra due entità.
E' in generale un servizio di trasporto di unità informative.

## Regole di accesso (primitive di servizio)
Il servizio di comunicazione può essere descritto mediate delle "chiamate a
servizio" dette primitive di servizio. Esse servono a descrivere, a richiederlo
e a ricevere informazioni su di esso.

Le primitive sono caratterizzate da parametri tra cui:
- informazione da trasferire
- indicazione del destinatario
- caratteristiche del servizio richiesto
- ...

Le primitive di servizio dell'interfaccia socket sono discusse a laboratorio.

## Caratteristiche
### Modalità a connessione
- Instaurazione della connessione
- Trasferimento
- Rilascio della connessione

Richiede una fase preliminare (instaurazione della connessione).

### Modalità senza connessione
- Si trasferisce direttamente l'informazione

# Protocollo di comunicazione
Un protocollo è l'insieme delle regole che gestiscono il colloquio tra entità:
- formato dei messaggi
- informazioni di servizio
- algoritmi di trasferimento
- ...

Quando due entità colloquiano tra di loro sono entità di pari livello.

## Cosa viene scambiato
L'oggetto dello scambio di informazioni sono le PDU (Packet Data Units). Le
PDU possono contenere sia tutte le informazioni di servizio (header) e i dai veri
e propri (data).

I dati di solito non sono legati alle regole del protocollo. I dati quindi vengono
da un livello superiore.

# Livelli di comunicazione
Due entità che colloquiano tra di loro possono offrire questo servizio di
comunicazione a entità terze. Queste entità terze sono dette di livello
superiore.

Proprio perchè i dati nel PDU possono essere forniti da un'entità di livello
superiore essi sono detti che provengono da un livello superiore.

Le entità di un livello, quindi, comunicano con le loro pari per offrire un
servizio di comunicazione alle entità di livello superiore. Nel fare ciò usano
il servizio di comunicazione offerto da altre entità di livello inferiore. Ciò
quindi permette di creare una gerarchia di livelli tra le vari entità.

Il servizio di comunicazione offerto dal livello superiore è pi ricco e
complesso grazie alle funzioni implementate dal livello inferiore.

I sistemi di comunicazione, quindi, vengono articolati a livelli: dal primo che
offre solo il trasporto di bit ad un livello dove sono definiti servizi
complessi. Internet è diviso principalmente in 5 livelli:
- L'applicazione crea un PDU di livello 5 che viene passato al servizio di
  comunicazione (livello 4);
- Il livello 4 vede questa PDU come un'unica entità alla quale aggiunge il suo
  header e lo manda al livello 3;
- Il livello 3 incapsula con il suo header i dati ricevuti;
- Il livello 2 incapsula con il suo header i dati ricevuti;
- Il livello 1 incapsula con il suo header i dati ricevuti e lo spedisce lungo
  la linea

- L'informazione arriva al primo livello del ricevente. Usa le informazioni del
  header di primo livello e le scarta passando i dati al livello 2;
- Il livello 2 usa le informazioni del header e le scarta passando i dati al
  livello 3;
- Il livello 3 usa le informazioni del header e le scarta passando i dati al
  livello 4;
- Il livello 4 usa le informazioni del header e le scarta passando i dati al
  livello 5;
- L'informazione è arrivata al livello 5 del ricevente e viene processata.

Si può vedere che ogni livello gestisce lo scambio di informaizioni sono con un
suo pari.

## Perchè i livelli?
- Facile identificazione dei servizi
- Facile gestione ed update: trasparenza verso i livelli superiori

La divisione in livelli può essere pericolosa?

## Modello a livelli di internet (TCP/IP)
| Livello | Nome        | PDU            |
|:-------:|:-----------:|:--------------:|
| 5       | Applicativo | Messaggi       |
| 4       | Trasporto   | Segmenti       |
| 3       | Rete        | Pacchetti      |
| 2       | Link        | Trame (frames) |
| 1       | Fisico      | Bit            |

## Funzioni dei vari livelli
Molteplici sono le funzioni che possono essere svolte da un livello.

### Multiplazione
Permette a più livelli superiori di condividere lo stesso servizio di
comunicazione. Nel momento in cui io trasferisco più informazioni di utilizzatori
diversi, alla ricezione devo essere in grado di risepararle dalla parte del 
ricevitore.

Esempio: 1 singolo indirizzo di rete, la multiplazione è data dal numero di 
porta (80, 25 ecc...)

### Controllo d'errore
E' possibile garantire l'affidabilità della comunicazione anche in presenza di
errori sul canale. 

Esempio: il TCP, quando invia un pacchetto, mette nell'header una sezione per il
controllo dell'errore. Il ricevitore userà questa sezione per verificare il 
pacchetto. Se tutto è andato bene, il ricevitore manda un segnale di tutto ok 
(ACK). Se il segnale non arriva al trasmittente, viene ritrasmesso il pacchetto.

### Instradamento (routing)
Il livello superiore passa al livello con instradamento il parametro di indirizzo.
L'indirizzo viene aggiunto nell'header in modo che possa essere instradato.

I pacchetti possono anche essere in entrata: l'entità instradante legge 
l'indirizzo e lo confronta con una tabella di instradamento e decide
se rimandarlo attraverso una porta d'uscita (forward). 

La tabella di routing possono essere scrtte:
- a mano (Human defined Networking). Le rotte scritte a mano vengono dette
  rotte statiche;
- protocolli di instradamento distribuiti. I nodi della rete scambiano tra di
  loro dei messaggi di servizio che permettono ai router di "imparare" da sé
  le rotte;
- software defined networking. Viene automatizzato con software il HDN;

Nota: il pacchetto in arrivo non sale mai più in alto nei livelli salvo che non
sia giunto a destinazione.

Nota: i nodi di rete spesso non salgono più in alto del livello di instradamento.
Un esempio di ciò sono i Router IP. La funzione di rete, però, non per forza è 
implementata al livello 3: 
- instradamento al livello 2: LAN switch;
- instradamento al livello 5: Proxy.




